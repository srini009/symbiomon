Build and run instructions:
--------------------------
Follow this sequence of steps to build and run LULESH with SYMBIOMON (this example assumed Theta as the platform of choice):
1. Install spack
2. Download the mochi repo from here: https://github.com/srini009/mochi-spack-packages. Add this repo to spack.
3. In this directory, make the LULESH program (make)
4. cd ./theta_run_scripts && source .sourceme.sh
5. Install SYMBIOMON using: . spack_symbiomon_recipe.sh (may take some time to build the entire stack)
6. Download this special flavor of TAU: https://github.com/srini009/tau2. Checkout the "symbiomon" branch.
7. Load the necessary symbiomon components: spack load mochi-symbiomon@develop+aggregator+bedrock+reducer
8. Unload the "pkgconf" package. It causes some annoying build failures: spack unload pkgconf 
9. Configure TAU with these flags:  ./configure -mpi -bfd=download -mochi -prefix=/path/to/TAU_INSTALL
10. The "small-run.qsub" file is a sample job submission script on Theta. Open the file and change the
lines that say "Change this line".
11. Run the script using: qsub -A radix-io -t 30 -n 4 -q debug-flat-quad --mode script small-run.qsub

Explanation of the setup:
------------------------
The small-run.qsub job script sets up three distributed components in this specified order:
1. The distributed AGGREGATOR service (launched as a collection of MPI processes). These service
 instances write out their addresses to a file (AGGREGATOR_ADDRESS_FILE).
2. The distributed REDUCER service (for global reduction of metric data). This service connects
to the AGGREGATOR using AGGREGATOR_ADDRESS_FILE. Additionally, the REDUCER writes out its own
address to a separate file (REDUCER_ADDRESS_FILE).
3. The MPI program (LULESH), instrumented using TAU/SYMBIOMON. As a part of the initialization routine,
each MPI process connects to the AGGREGATOR and REDUCER instances through TAU.

SYMBIOMON is a time-series metric monitoring service. TAU is used to seamlessly capture MPI performance
data from the application (LULESH) and convert the performance data thus gathered to SYMBIOMON metrics. 
This conversion happens inside tau2/plugins/examples/Tau_plugin_mochi_symbiomon.cpp. At the end of 
every iteration, the LULESH application is instrumented to invoke the "Tau_dump" routine. The TAU SYMBIOMON
plugin "hooks into" the dump event and uses this event to capture performance data from the application seamlessly.

At the end of each iteration, each MPI process records (updates) the SYMBIOMON metrics corresponding
to TAU performance data inside tau2/plugins/examples/Tau_plugin_mochi_symbiomon.cpp. Once every "N"
iterations, each process reduces the locally collected SYMBIOMON metrics using a "reduction operator"
defined with the metric. In this example, the reduction operator is "MAX". Metric reduction results
in an RPC being sent from each MPI process to one of the AGGREGATOR instances. Specifically, 
one RPC is sent per MPI process per SYMBIOMON metric. After locally reduced values are stored
in the aggregator, rank 0 performs a global reduction of the metric data by contacting the REDUCER
service. 

The globally reduced metric data is written to STDERR ($JOB_ID.err). Metric reduction frequency
is controlled using the environment variable TAU_SYMBIOMON_REDUCTION_FREQUENCY.


